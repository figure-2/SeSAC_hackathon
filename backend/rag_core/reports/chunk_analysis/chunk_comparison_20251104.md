# Chunk Rechunking Impact Comparison (2025-11-04)

## 정량 평가 비교 (`2_run_evaluation.py`, eval_qa_dataset.json 기준)

| 상태 | Retrieval Hit Rate | Retrieval MRR | Rerank Hit Rate | Rerank MRR |
| --- | --- | --- | --- | --- |
| 재청킹 적용 (`evaluation_history` timestamp 2025-11-03T14:13:01Z 이후) | 0.3969 | 0.2698 | 0.3629 | 0.3144 |
| 원본 청크 복원 (`evaluation_history` timestamp 2025-11-04T02:27:05Z) | 0.5901 | 0.3711 | 0.5379 | 0.4528 |

> 재청킹 후 Hit Rate/MRR가 크게 하락했고, 원본 복원 시 곧바로 기존 수준 이상으로 회복함.

## 정성 평가 스냅샷 (`run_batch_rag.py`, 대표 4문항)

- **재청킹 청크 (`20251104_015326_rechunked`)**: `ex_001` 답변에서 특정 문구 반복, 질문과 동떨어진 설명 다수.
- **원본 청크 (`20251104_021916_baseline_chunks`)**: 반복은 줄었으나 여전히 정확한 수치·직답 부족. 프롬프트/Top-k 보완 필요.

## 원인 추정
1. **의미 단위 분리 손실**: 장문을 잘게 나누면서 질문과 직접 연결된 문장이 다른 청크로 이동, Retriever hit 감소.
2. **요약 부재**: 분할만 수행했고 핵심 요약을 삽입하지 않아, 개별 청크가 질문을 충분히 설명하지 못함.
3. **LLM 입력 품질 하락**: 재청킹된 청크는 짧지만 맥락 연결이 약해져 LLM이 반복/헛소리를 생성.

## 후속 액션 제안
1. **재청킹 파이프라인 개선**
   - 문단 중요도 기반 선택, 핵심 문장 유지 로직 추가.
   - 필요 시 문단 요약을 생성해 청크 앞부분에 첨부.
2. **검색 파라미터 실험**
   - 재청킹 버전으로 BM25 가중치, Top-k, rerank_k 조합을 재탐색해 성능 회복 가능성 검증.
3. **정성 평가 자동 검수**
   - 반복/헛소리를 Catch 하는 규칙(키워드 검증, 길이 제한)을 넣어 문제 답변을 빠르게 식별.
4. **현재 운영 결정**
   - 당분간 기존 청크(1924건)를 유지하고, 개선된 재청킹 전략이 검증될 때까지 별도 분기에서 실험.
